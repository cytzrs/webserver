<!DOCTYPE html>
<html lang='en' xmlns:wb='http://open.weibo.com/wb'>
<head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <title>
        cytzrs/mvc-servlet/edit |
        CODE
    </title>
    <link href="//csdnimg.cn/public/favicon-b.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
    <script src='//csdnimg.cn/pubfooter/js/tracking.js?4844345'></script>
    <link href="//csdnimg.cn/public/common/toolbar/css/index.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/assets/application-652cbb85a3f966bb08f095133db2e7b4.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-957fc12b636de8abaea72685ec9069c5.js" type="text/javascript"></script>
    <link href="/assets/feature_groups/settings-cc7f661d0f132afffa268ed77c35a376.css" media="screen" rel="stylesheet" type="text/css" />

    <script src='https://code.csdn.net/open/api/js/wb.js'></script>

    <meta content="authenticity_token" name="csrf-param" />
    <meta content="XioPQ+PqNinxyhUtUjnNU+nXVmu7wZYpIm1xBhb8gMM=" name="csrf-token" />
</head>

<body>
<script fixed='true' id='toolbar-tpl-scriptId' prod='code' skin='black' src='//csdnimg.cn/public/common/toolbar/js/html.js' type='text/javascript'></script>
<script>
    //<![CDATA[
    var protocol = window.location.protocol;
    document.write('<script type="text/javascript" src="' +protocol+ '//csdnimg.cn/pubfooter/js/repoAddr2.js?v=' + Math.random() + '"></'+'script>');
    //]]>
</script>
<header class='csdn-nav navbar navbar-static-top' role='banner'>
    <div class='container'>
        <nav class='navbar-collapse pull-left' role='navigation'>
            <ul class='navbar-nav'>
                <li class=''>
                    <a href="/explore/projects">发现</a>
                </li>
                <li class=''>
                    <a href='/openkb'>知识库</a>
                </li>
                <li class=''>
                    <a href='/group'>讨论组</a>
                </li>
                <li class=''>
                    <a href="/translations">翻译</a>
                </li>
            </ul>
        </nav>
        <div class='search col-xs-6'>
            <form action='/search' method='get'>
                <div class='input-group'>
                    <input accesskey='s' class='form-control input-sm new' id='s' name='search' placeholder='搜索' required='required' size='30' tabindex='1' type='text'>
                    <div class='input-group-btn'>
                        <button class='btn btn-default btn-sm' type='submit'>
                            <i class='fa fa-search'></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div class='pull-right'>
            <a href="/dashboard/index">我的CODE</a>
            <a data-original-title='设置' data-toggle='tooltip' href='/keys'>
                <i class='fa fa-cog'></i>
            </a>
        </div>
    </div>
</header>
<script>
    //<![CDATA[
    $('.dropdown-menu > li > a').click(function(){
        if ($(this).attr("name") == "aaa"){
            $('#search_form').attr('action', '/search');
        }else{
            $('#search_form').attr('action', '/search_project');
        }
        $('#sec_attr').text($(this).text());
    });
    function btnclick(str){
        var url = (str == "1" ? "/search" : "/search_project");
        $('#search_form').attr('action', url).submit();
    }
    //]]>
</script>
<!--[if lt IE 9]> <div class="no-ie8 alert alert-block"><h4>请注意：</h4><p>Code不支持ie8及以下版本；建议您升级到最新的ie浏览器，或者谷歌Chrome、Firefox、Safari等；如果您使用的是IE 9+，请关闭“兼容性视图”。</p></div> <![endif]-->

<!-- = render "sdev_toolshared/user_diskspace_over_limit" -->

<div class='container main_container'>
    <div class='setting-page'>
        <div class='setting_head'>
            <h1>
                项目设置
            </h1>
            <div class='title_project_name'>
                <i class='icon-c-public'></i>
                <a href="/cytzrs">cytzrs</a>/<a href="/cytzrs/mvc-servlet">mvc-servlet</a>
            </div>

        </div>
        <div class='sidebar pull-left'>
            <ul class='sidebar_nav'>
                <li class='active'>
                    <a href="/cytzrs/mvc-servlet/edit">项目设置</a>
                </li>
                <li class='false'>
                    <a href="/cytzrs/mvc-servlet/settings/team_members">项目成员</a>
                </li>
                <li class=''>
                    <a href="/cytzrs/mvc-servlet/feature_manage">功能管理</a>
                </li>
                <li class=''>
                    <a href="/cytzrs/mvc-servlet/deploy_keys">项目公钥</a>
                </li>
                <li class=''>
                    <a href="/cytzrs/mvc-servlet/hooks">Hooks</a>
                </li>
            </ul>

        </div>
        <div class='content_box pull-right'>
            <form accept-charset="UTF-8" action="/cytzrs/mvc-servlet/rename" class="edit_project" id="rename_form" method="post" onsubmit="return renameValidate();"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="XioPQ+PqNinxyhUtUjnNU+nXVmu7wZYpIm1xBhb8gMM=" /></div>
                <div class='panel panel-default'>
                    <div class='panel-heading'>
                        项目名称
                    </div>
                    <div class='panel-body'>
                        <div class='form-horizontal'>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    项目名称：
                                </label>
                                <div class='col-sm-9'>
                                    <input class="form-control" id="project_name" name="project[name]" size="30" type="text" value="mvc-servlet" />
                                </div>
                                <input id="project_default_name" name="project[default_branch]" type="hidden" value="master" />
                            </div>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    默认分支：
                                </label>
                                <div class='col-sm-9'>
                                    <div class='btn-group' id='branch_group'>
                                        <a class='btn btn-sm btn-default' id='branch_name_btn'>
                                            master
                                        </a>
                                        <button class='btn btn-sm btn-default dropdown-toggle' data-toggle='dropdown'>
                                            <span class='caret'></span>
                                        </button>
                                        <ul class='dropdown-menu' id='branch_menu'>
                                            <li>
                                                <a href="javascript:void(0);" class="branch-name" ref="master">master</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class='form-group'>
                                <div class='col-sm-12 text-right'>
                                    <input class="btn btn-success" id="rename-button" name="button" type="submit" value="更 改" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <form accept-charset="UTF-8" action="/cytzrs/mvc-servlet/update_desc" class="edit_project" id="update_desc_form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="XioPQ+PqNinxyhUtUjnNU+nXVmu7wZYpIm1xBhb8gMM=" /></div>
                <div class='panel panel-default'>
                    <div class='panel-heading'>
                        项目描述：
                    </div>
                    <div class='panel-body'>
                        <div class='form-horizontal'>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    项目描述：
                                </label>
                                <div class='col-sm-9'>
                                    <input class="form-control" id="textfield2" name="project[description]" size="30" type="text" value="mvc-servlet" />
                                </div>
                            </div>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    项目主页：
                                </label>
                                <div class='col-sm-9'>
                                    <input class="form-control" id="textfield3" name="project[home_page_url]" size="30" type="text" value="" />
                                </div>
                                <div align='right' class='col-sm-9'></div>
                            </div>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    关联的讨论组：
                                </label>
                                <div class='col-sm-9'>
                                    <input class="form-control" id="textfield4" name="project[group_url]" size="30" type="text" value="" />
                                </div>
                            </div>
                            <div class='form-group'>
                                <label class='col-sm-3 control-label'>
                                    项目标签：
                                </label>
                                <div class='col-sm-9'>
                                    <script src="/assets/csdn_tags/main_code-8a856168fb693c4d7d49185aac2f3f27.js" type="text/javascript"></script>
                                    <link href="/assets/csdn_tags/main-9657630a58eb9341a1fda4e7a2f5b209.css" media="screen" rel="stylesheet" type="text/css" />
                                    <div class='tag_input tag' id='tags'>
                                        <input id='autocompleteTags' placeholder='可选' size='60'>
                                    </div>
                                    <script>
                                        //<![CDATA[
                                        //标签初始化
                                        var old_title = null;
                                        var old_content = null;
                                        csdn.AutoTags.run();
                                        $(function(){
                                            recomend_flag = false;
                                            var old_tags = "mvc, servlet, xml";
                                            if (old_tags != "" || old_tags == null){
                                                tags.addDefault(old_tags);
                                            }

                                            if (recomend_flag){
                                                $("#tags input").focus(function(){
                                                    var new_title = get_all_title();
                                                    var new_content = get_all_content();
                                                    if(old_title != new_title || old_content != new_content){
                                                        old_title = new_title;
                                                        old_content = new_content;
                                                        tags.initTags(new_title, new_content);
                                                    }
                                                });
                                            }
                                            $("#tags input").closest("form").submit(function(){
                                                get_tags();
                                            });
                                        });

                                        function get_all_title(){
                                            var title = $("#project_name").val();
                                            return title
                                        }

                                        function get_all_content(){
                                            var content = $("#project_description").val();
                                            return content
                                        }


                                        function get_tags(){
                                            var tag = '';
                                            $('#tags span').each(function(){
                                                tag += $(this).text() + ',';
                                            });
                                            tag = tag.substring(0,tag.lastIndexOf(','));
                                            if(document.getElementById('project_tags')){
                                                $("#project_tags").val(tag);
                                            }else{
                                                tag_html = '<input type="hidden" id="project_tags" name="project[tags]" value="' + tag + '" />';
                                                $("#tags").after(tag_html);
                                            }
                                        }
                                        //]]>
                                    </script>


                                </div>
                            </div>
                            <div class='form-group'>
                                <div class='col-sm-12 text-right'>
                                    <input class="btn btn-success" id="button" name="button" type="submit" value="更 改" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class='panel panel-danger'>
                <div class='panel-heading'>
                    危险操作
                </div>
                <div class='panel-body'>
                    <div class='form-horizontal'>
                        <div class='form-group'>
                            <div class='col-sm-9'>
                                改变项目主人，将项目拥有者身份转授给其他人
                            </div>
                            <div class='col-sm-3 text-right'>
                                <a class='btn btn-sm btn-danger' data-toggle='modal' href='#myModal'>
                                    更 改
                                </a>
                            </div>
                        </div>
                        <div class='form-group'>
                            <div class='col-sm-9'>
                                变更项目公开性
                            </div>
                            <div class='col-sm-3 text-right'>
                                <a class='btn btn-sm btn-danger' data-toggle='modal' href='#myModa2'>
                                    私 有
                                </a>
                            </div>
                        </div>
                        <div class='form-group'>
                            <div class='col-sm-9'>
                                删除项目，项目一旦删除将无法恢复
                            </div>
                            <div class='col-sm-3 text-right'>
                                <a class='btn btn-sm btn-danger' data-toggle='modal' href='#myModa3'>
                                    删 除
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='modal fade master_replace' id='myModal'>
                <div class='modal-dialog'>
                    <div class='modal-content'>
                        <div class='modal-header'>
                            <button aria-hidden class='close' data-dismiss='modal'>×</button>
                            <div class='modal-title'>
                                改变项目主人?
                            </div>
                        </div>
                        <div class='modal-body'>
                            <div class='alert alert-danger'>
                                项目的主人身份和管理权限将移交给他人，您将失去对项目的管理权限！
                            </div>
                            <form accept-charset="UTF-8" action="/cytzrs/mvc-servlet/update_owner" class="edit_project" id="update_owner_form" method="post" onsubmit="return before_trsowner_submit();"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="XioPQ+PqNinxyhUtUjnNU+nXVmu7wZYpIm1xBhb8gMM=" /></div>
                                <div class='input-group'>
                                    <input class='form-control' id='autocomplete' name='' placeholder='搜索用户' type='text'>
                                    <div class='input-group-btn'>
                                        <button class='btn btn-success' disabled id='autocomplete_submit_btn'>更改</button>
                                    </div>
                                </div>
                                <input id='autocomplete_owner_id' name='owner_id' type='hidden'>
                                <input id='owner_type' name='owner_type' type='hidden'>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class='modal fade' id='myModa2'>
                <div class='modal-dialog'>
                    <div class='modal-content'>
                        <div class='modal-header'>
                            <button aria-hidden class='close' data-dismiss='modal'>×</button>
                            <h4 class='modal-title'>
                                将此项目私有？
                            </h4>
                        </div>
                        <div class='modal-body'>
                            <p aria-hidden class='text-center' data-dismiss='modal'>
                                <a href="/cytzrs/mvc-servlet/switch_public" class="btn btn-primary btn-lg" data-method="put" rel="nofollow">确 定</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class='modal fade' id='myModa3'>
                <div class='modal-dialog'>
                    <div class='modal-content'>
                        <div class='modal-header'>
                            <button aria-hidden class='close' data-dismiss='modal'>×</button>
                            <h4 class='modal-title'>
                                确定删除此项目？
                            </h4>
                        </div>
                        <div class='modal-body'>
                            <p aria-hidden class='text-center' data-dismiss='modal'>
                                <a href="/cytzrs/mvc-servlet" class="btn btn-primary btn-lg" data-method="delete" rel="nofollow">确 定</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class='modal fade' id='rename-no-title'>
                <div class='modal-dialog'>
                    <div class='modal-content'>
                        <div class='modal-header'>
                            <button aria-hidden class='close' data-dismiss='modal'>×</button>
                            <h4 class='modal-title'>
                                提示
                            </h4>
                        </div>
                        <div class='modal-body'>
                            <p aria-hidden class='text-center' data-dismiss='modal'>
                                <button aria-hidden class='btn btn-primary btn-lg' data-dismiss='modal'>
                                    确 定
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class='modal fade' id='rename-no-change'>
                <div class='modal-dialog'>
                    <div class='modal-content'>
                        <div class='modal-header'>
                            <button aria-hidden class='close' data-dismiss='modal'>×</button>
                            <h4 class='modal-title'>
                                提示
                            </h4>
                        </div>
                        <div class='modal-body'>
                            <p aria-hidden class='text-center' data-dismiss='modal'>
                                <button aria-hidden class='btn btn-primary btn-lg' data-dismiss='modal'>
                                    确 定
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                //<![CDATA[
                function set_default_branch(__default_branch){
                    $("#project_default_name").val(__default_branch);
                    $("#branch_name_btn").text(__default_branch);
                }

                $(document).on("click", ".branch-name", function(){
                    set_default_branch($(this).attr("ref"));
                });

                $(document).on("click", ".btn-group button.dropdown-toggle", function(){
                    $("#branch_menu_tip").remove();
                    if($("#branch_menu").length == 0){
                        $.get("/cytzrs/mvc-servlet/branch_names")
                                .success(function(data){
                                    if(data.state == true){
                                        var _ul = $("<ul class='dropdown-menu' id='branch_menu'></ul>");
                                        for(var i=0;i<data.branches.length;i++){
                                            var _ref = data.branches[i]
                                            var _a = $("<a href=\"javascript:void(0);\" onclick=\"set_default_branch('" + _ref + "');\"></a>")
                                            _a.text(_ref);
                                            var _li = $("<li></li>");
                                            _li.append(_a);
                                            _ul.append(_li);
                                        }
                                        $("#branch_group").append(_ul);
                                    } else {
                                        var _ul = $("<ul class='dropdown-menu' id='branch_menu_tip'></ul>");
                                        var _a = $("<a href='javascript:void(0);'></a>")
                                        var _li = $("<li></li>");
                                        _a.text("请稍候尝试");
                                        _li.append(_a);
                                        _ul.append(_li);
                                        $("#branch_group").append(_ul);
                                    }
                                });
                    }
                });

                function renameValidate(){
                    var lastName = "mvc-servlet";
                    var newName = $("#project_name").val();

                    doc_name_change = false;
                    var lastDocName = "";
                    var newDocName = $("#project_doc_name").val();
                    if(newDocName && lastDocName != newDocName){
                        doc_name_change = true;
                    }

                    project_default_name_change = false;
                    var project_default_name = $("#project_default_name").val();
                    if( project_default_name && project_default_name != "master"){
                        project_default_name_change = true;
                    }

                    if (lastName == newName && !project_default_name_change && !doc_name_change) {
                        $("#rename-no-change").modal('toggle');
                        $("#rename-button").button("reset");
                        return false;
                    }

                    if (newName == "") {
                        $("#rename-no-title").modal('toggle');
                        $("#rename-button").button("reset");
                        return false;
                    }

                    return true;

                }
                //]]>
            </script>


            <script>
                //<![CDATA[
                $(document).ready(function () {

                    document.availableTags = [];
                    Array.prototype.containsValue = function(obj) {
                        var i = this.length;
                        while (i--) {
                            if (this[i].value === obj) {
                                return true;
                            }
                        }
                        return false;
                    }
                    $("#autocomplete").autocomplete({
                        source: document.availableTags,
                        messages: {
                            noResults: '',
                            results: function() {}
                        }
                    });

                    _renderItem = function (ul, item) {
                        var icon = "<i class='icon-user'></i>"
                        if(item.org == true){
                            icon = "<i class='icon-group'></i>"
                        }
                        return jQuery("<li></li>")
                                .data("item.autocomplete", item)
                                .append("<a>" + icon + item.value + "</a>")
                                .appendTo(ul);
                    };

                    $("#autocomplete").keyup(function(){
                        validationInput();
                    });
                    $(".ui-autocomplete").click(function(){
                        validationInput();
                    });

                });

                function validationInput(){
                    var _val = $('#autocomplete').val();
                    validateName(_val);
                }

                function validate_project_name(){
                    var rgExp=/^[a-zA-Z0-9_][a-zA-Z0-9_\-\.]*$/;
                    if($("#project_name").val()!=null && rgExp.test($("#project_name").val())){
                        $("#project_name").addClass("correct");
                    }else{
                        $("#project_name").removeClass("correct");
                    }
                }


                function validateName(_val){
                    if(typeof _val == "undefined"){
                        _val = $('#autocomplete').val();
                    }
                    search_users(_val);
                }


                var _in_ajax;
                var _in_valid = false;
                function search_users(__search_key){
                    $('#autocomplete_btn').removeClass("d_change_btn d_change_btn_blue").addClass("d_change_btn d_change_btn_gray");
                    _in_ajax = $.ajax({
                        url: "/search_users_and_organizations",
                        type: 'POST',
                        data: {key: __search_key},
                        dataType: 'json',
                        error: function(){
                        },
                        success: function(json){
                            if( json == null || typeof json == undefined || json.length == 0){
                                if(document.availableTags.containsValue(__search_key)){
                                    _in_valid = true;
                                    $("#autocomplete_submit_btn").attr("disabled", false);
                                } else {
                                    $("#autocomplete_submit_btn").attr("disabled", true);
                                }
                                return true;
                            }
                            document.users_json = json;
                            document.availableTags = [];
                            _in_valid = false;
                            for(var i = 0; i < json.length; i++){
                                // 去掉自己
                                if("false" == "false" && json[i].username == "cytzrs"){
                                    continue;
                                }
                                // 去掉项目所在的组织
                                if("true" == "false"){
                                    if("@project.organization.name" == json[i].name){
                                        continue;
                                    }
                                }
                                if(json[i].org == true){
                                    document.availableTags[document.availableTags.length] ={org: true , value: json[i].name};
                                } else {
                                    document.availableTags[document.availableTags.length] ={org: false , value: json[i].nick_name + "(" + json[i].username + ")"};
                                }
                                if(document.availableTags.containsValue(__search_key)){
                                    _in_valid = true;
                                    $("#autocomplete_submit_btn").attr("disabled", false);
                                }
                            }
                            $("#autocomplete").autocomplete({
                                source: document.availableTags,
                                messages: {
                                    noResults: '',
                                    results: function() {}
                                }
                            });
                            if(_in_valid){
                                $("#autocomplete_submit_btn").attr("disabled", false);
                            } else{
                                $("#autocomplete_submit_btn").attr("disabled", true);
                            }

                        }
                    });

                }

                function before_trsowner_submit(){
                    if(_in_valid){
                        var _var = $('#autocomplete').val();
                        for(var i = 0; i < document.users_json.length; i++){
                            if(document.users_json[i].org == true){
                                var user_json_name =  document.users_json[i].name;
                                if(user_json_name == _var){
                                    $("#autocomplete_owner_id").val(document.users_json[i].id);
                                    $("#owner_type").val("organization");
                                    return true;
                                }
                            } else {
                                var user_json_name =  document.users_json[i].nick_name + "(" + document.users_json[i].username + ")";
                                if(user_json_name == _var){
                                    $("#autocomplete_owner_id").val(document.users_json[i].id);
                                    $("#owner_type").val("user");
                                    return true;
                                }
                            }
                        }
                    }
                    return false;
                }
                //]]>
            </script>


        </div>
    </div>

</div>
<div class='footer'>
    <div class='container'>
        <ul class='pull-left list-inline'>
            <li>
                <a href='/CSDN_Code/code_support/issues'>反馈</a>
            </li>
            <li>
                <a href="/help">帮助</a>
            </li>
        </ul>
        <div class='pull-right'>Copyright &copy; 2015, CSDN.NET, All Rights Reserved</div>
    </div>
</div>
<script btnid='header_notice_num' count='5' id='noticeScript' src='//csdnimg.cn/rabbit/notev2/js/notify.js?4844345' subcount='5' type='text/javascript' wrapid='note1'></script>
<script btnId='header_notice_num' count='5' id='csdn-toolbar-id' src='//csdnimg.cn/public/common/toolbar/js/toolbar.js' subCount='5' type='text/javascript' wrapId='note1'></script>

</body>
</html>


